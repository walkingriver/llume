<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="description" content="Tour of Heroes - LLuMe implementation">
<title>Tour of Heroes</title>
</head>
<body class="p3">
<h1 class="t6 c1 tb my2" data-m-tx="title"></h1>
<nav class="f g2 my3">
<a href="#/" class="bg r px3 py2 tdn cb cp">Dashboard</a>
<a href="#/heroes" class="bg r px3 py2 tdn cb cp">Heroes</a>
</nav>

<!-- Dashboard View -->
<section data-m-route="/" class="f fc g3">
<h2 class="t5 c1" data-m-tx="topHeroes"></h2>
<div id="dash-heroes" data-m-bind="topHeroes" data-m-tpl="dash-tpl" data-m-key="id" class="f fw g2"></div>
<template id="dash-tpl"><a href="#" class="fg b1 cw p4 r tc tdn cp" style="min-width:120px" onclick="location.hash='/detail/'+this.dataset.mK;return false"><span data-m-f="name"></span></a></template>
<h3 class="t4 c1 my2" data-m-tx="heroSearch"></h3>
<input type="text" id="search" placeholder="Search heroes..." oninput="window._search(this.value)" class="xw1">
<ul id="search-results" data-m-bind="searchResults" data-m-tpl="search-tpl" data-m-key="id" class="f fc g1 my2"></ul>
<template id="search-tpl"><li class="bg p2 r"><a href="#" class="c1 tdn" onclick="location.hash='/detail/'+this.closest('li').dataset.mK;return false"><span data-m-f="name"></span></a></li></template>
</section>

<!-- Heroes List View -->
<section data-m-route="/heroes" class="f fc g3">
<h2 class="t5 c1" data-m-tx="myHeroes"></h2>
<div class="f g2">
<input type="text" id="newHero" placeholder="Hero name...">
<button data-m-enhance="primary" onclick="window._add()">Add hero</button>
</div>
<ul id="hero-list" data-m-bind="heroes" data-m-tpl="hero-tpl" data-m-key="id" class="f fc g1"></ul>
<template id="hero-tpl"><li class="f fi g2 p2 bg r cp" onclick="window._select(this)"><span class="b1 cw px2 py1 r t2" data-m-f="id"></span><span class="fg" data-m-f="name"></span><button class="b2 cw px2 py1 r t2" onclick="event.stopPropagation();window._delete(this)">x</button></li></template>
<div data-m-if="selectedHero" id="mini-detail" class="bd r p3 my2">
<h4 class="tu tb c1" data-m-bind="selectedHero.name|upper"></h4>
<p class="my1">id: <span data-m-bind="selectedHero.id"></span></p>
<p class="my1">name: <span data-m-bind="selectedHero.name"></span></p>
<a href="#" id="view-link" class="c1">View Details</a>
</div>
</section>

<!-- Hero Detail View -->
<section data-m-route="/detail/:id" class="f fc g3 xw2">
<h2 class="t5 c1"><span data-m-bind="editHero.name|upper"></span> Details</h2>
<div class="f fc g2">
<p>id: <span class="tb" data-m-bind="editHero.id"></span></p>
<label class="f fc g1">Hero name:<input type="text" id="edit-name" data-m-bind="editHero.name" oninput="window._editName(this.value)"></label>
</div>
<div class="f g2">
<button data-m-enhance="secondary" onclick="history.back()">Go back</button>
<button data-m-enhance="primary" onclick="window._save()">Save</button>
</div>
</section>

<script type="application/llume+json" id="manifest">{"v":1,"r":{"s":{"heroes":[{"id":12,"name":"Dr. Nice"},{"id":13,"name":"Bombasto"},{"id":14,"name":"Celeritas"},{"id":15,"name":"Magneta"},{"id":16,"name":"RubberMan"},{"id":17,"name":"Dynama"},{"id":18,"name":"Dr. IQ"},{"id":19,"name":"Magma"},{"id":20,"name":"Tornado"}],"topHeroes":[],"selectedHero":null,"selectedId":null,"editHero":null,"searchTerm":"","searchResults":[]}},"l":{"en":{"title":"Tour of Heroes","topHeroes":"Top Heroes","myHeroes":"My Heroes","heroSearch":"Hero Search"}},"t":{"--m-p":"#369","--m-s":"#555"}}</script>
<script type="module">
import{l}from"../llume.js";
const initTop=()=>{const s=l.s();l.u({topHeroes:s.heroes.slice(0,4)});};
window._search=(term)=>{const s=l.s();if(!term.trim()){l.u({searchResults:[]});return;}l.u({searchResults:s.heroes.filter(h=>h.name.toLowerCase().includes(term.toLowerCase()))});};
window._select=(li)=>{const id=parseInt(li.dataset.mK),s=l.s(),hero=s.heroes.find(h=>h.id===id);l.u({selectedHero:hero,selectedId:id});const vl=l.q('#view-link');if(vl)vl.href=`#/detail/${id}`;};
window._add=()=>{const inp=l.q('#newHero'),name=inp.value.trim();if(!name)return;const s=l.s(),maxId=Math.max(...s.heroes.map(h=>h.id),10);l.u({heroes:[...s.heroes,{id:maxId+1,name}]});inp.value='';initTop();};
window._delete=(btn)=>{const id=parseInt(btn.closest('li').dataset.mK),s=l.s();l.u({heroes:s.heroes.filter(h=>h.id!==id),selectedHero:null,selectedId:null});initTop();};
window._editName=(name)=>{const s=l.s();if(s.editHero)l.u({editHero:{...s.editHero,name}});};
window._save=()=>{const s=l.s();if(!s.editHero)return;l.u({heroes:s.heroes.map(h=>h.id===s.editHero.id?{...s.editHero}:h),selectedHero:null,selectedId:null});initTop();history.back();};
const onRoute=()=>{const p=l.p();if(p.id){const s=l.s(),hero=s.heroes.find(h=>h.id===parseInt(p.id));if(hero)l.u({editHero:{...hero}});}};
l.h({});initTop();window.addEventListener('hashchange',onRoute);onRoute();
</script>
</body>
</html>
