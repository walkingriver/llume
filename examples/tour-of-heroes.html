<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="description" content="Tour of Heroes - LLasM implementation">
<title>Tour of Heroes</title>
</head>
<body class="p3">
<header class="f fb fi my2">
<h1 class="t6 c1 tb" data-m-tx="title"></h1>
<button data-m-enhance="darkmode secondary" class="r">Dark</button>
</header>
<nav class="f g2 my3">
<a href="#/" class="bg r px3 py2 tdn cb cp tr">Dashboard</a>
<a href="#/heroes" class="bg r px3 py2 tdn cb cp tr">Heroes</a>
</nav>

<!-- Dashboard View -->
<section data-m-route="/" class="f fc g3">
<h2 class="t5 c1" data-m-tx="topHeroes"></h2>
<div data-m-if="topHeroes.length==0" class="p3 bg r tc cg">Loading heroes...</div>
<div id="dash-heroes" data-m-bind="topHeroes" data-m-tpl="dash-tpl" data-m-key="id" class="g gc4 g2 sm:gc2"></div>
<template id="dash-tpl"><a class="b1 cw p4 r tc tdn cp tr" data-m-on="click:viewHero"><span data-m-f="name"></span></a></template>
<h3 class="t4 c1 my2" data-m-tx="heroSearch"></h3>
<input type="text" data-m-on="input:search" placeholder="Search heroes..." class="xw1">
<ul data-m-if="searchResults.length>0" data-m-bind="searchResults" data-m-tpl="search-tpl" data-m-key="id" class="f fc g1 my2"></ul>
<template id="search-tpl"><li class="bg p2 r tr"><a class="c1 tdn cp" data-m-on="click:viewHero"><span data-m-f="name"></span></a></li></template>
</section>

<!-- Heroes List View -->
<section data-m-route="/heroes" class="f fc g3">
<h2 class="t5 c1" data-m-tx="myHeroes"></h2>
<div class="f g2">
<input type="text" data-m-bind="newHeroName" placeholder="Hero name...">
<button data-m-on="click:addHero" data-m-enhance="primary">Add hero</button>
</div>
<div data-m-if="heroes.length==0" class="p3 bg r tc cg">No heroes yet.</div>
<ul data-m-bind="heroes" data-m-tpl="hero-tpl" data-m-key="id" class="f fc g1"></ul>
<template id="hero-tpl"><li class="f fi g2 p2 bg r cp tr" data-m-on="click:selectHero"><span class="b1 cw px2 py1 r t2" data-m-f="id"></span><span class="fg ell" data-m-f="name"></span><button data-m-on="click:deleteHero" data-m-enhance="secondary" class="t2 py1 px2">x</button></li></template>
<div data-m-if="selectedHero" class="bd r p3 my2 fade">
<h4 class="tu tb c1" data-m-bind="selectedHero.name|upper"></h4>
<p class="my1 cg">id: <span data-m-bind="selectedHero.id"></span></p>
<a class="c1 cp" data-m-on="click:goDetail">View Details</a>
</div>
</section>

<!-- Hero Detail View -->
<section data-m-route="/detail/:id" class="f fc g3 xw2 fade">
<h2 class="t5 c1"><span data-m-bind="editHero.name|upper"></span> Details</h2>
<div class="f fc g2">
<p>id: <span class="tb" data-m-bind="editHero.id"></span></p>
<label class="f fc g1">Hero name:<input type="text" data-m-bind="editHero.name" data-m-on="input:editName"></label>
</div>
<div class="f g2">
<button data-m-on="click:goBack" data-m-enhance="secondary">Go back</button>
<button data-m-on="click:saveHero" data-m-enhance="primary">Save</button>
</div>
</section>

<script type="application/llasm+json" id="manifest">{"v":1,"r":{"s":{"heroes":[{"id":12,"name":"Dr. Nice"},{"id":13,"name":"Bombasto"},{"id":14,"name":"Celeritas"},{"id":15,"name":"Magneta"},{"id":16,"name":"RubberMan"},{"id":17,"name":"Dynama"},{"id":18,"name":"Dr. IQ"},{"id":19,"name":"Magma"},{"id":20,"name":"Tornado"}],"topHeroes":[],"selectedHero":null,"editHero":null,"searchResults":[],"newHeroName":""}},"persist":["heroes"],"l":{"en":{"title":"Tour of Heroes","topHeroes":"Top Heroes","myHeroes":"My Heroes","heroSearch":"Hero Search"}},"t":{"--m-p":"#369","--m-s":"#555"}}</script>
<script type="module">
import{l}from"../llasm.js";
const initTop=()=>{const s=l.s();l.u({topHeroes:s.heroes.slice(0,4)});};
const onRoute=()=>{const p=l.p();if(p.id){const s=l.s(),hero=s.heroes.find(h=>h.id===parseInt(p.id));if(hero)l.u({editHero:{...hero}});}};
l.h({
  search:(e)=>{const term=e.target.value,s=l.s();if(!term.trim()){l.u({searchResults:[]});return;}l.u({searchResults:s.heroes.filter(h=>h.name.toLowerCase().includes(term.toLowerCase()))});},
  viewHero:(e,s,L,el)=>{const id=el.closest('[data-m-k]').dataset.mK;location.hash=`/detail/${id}`;},
  selectHero:(e,s,L,el)=>{if(e.target.tagName==='BUTTON')return;const id=parseInt(el.dataset.mK),hero=s.heroes.find(h=>h.id===id);l.u({selectedHero:hero});},
  goDetail:()=>{const s=l.s();if(s.selectedHero)location.hash=`/detail/${s.selectedHero.id}`;},
  addHero:()=>{const s=l.s(),name=s.newHeroName.trim();if(!name)return;const maxId=Math.max(...s.heroes.map(h=>h.id),10);l.u({heroes:[...s.heroes,{id:maxId+1,name}],newHeroName:''});initTop();l.t('Hero added!','ok');},
  deleteHero:(e,s,L,el)=>{e.stopPropagation();const id=parseInt(el.closest('li').dataset.mK);l.u({heroes:s.heroes.filter(h=>h.id!==id),selectedHero:null});initTop();l.t('Hero deleted','info');},
  editName:(e)=>{const s=l.s();if(s.editHero)l.u({editHero:{...s.editHero,name:e.target.value}});},
  saveHero:()=>{const s=l.s();if(!s.editHero)return;l.u({heroes:s.heroes.map(h=>h.id===s.editHero.id?{...s.editHero}:h),selectedHero:null});initTop();l.t('Hero saved!','ok');history.back();},
  goBack:()=>history.back()
});
initTop();
window.addEventListener('hashchange',onRoute);
onRoute();
</script>
</body>
</html>
